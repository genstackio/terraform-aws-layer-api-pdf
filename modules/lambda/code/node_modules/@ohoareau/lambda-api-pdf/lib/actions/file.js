"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const lambda_utils_1 = require("@ohoareau/lambda-utils");
const availableStaticSources = __importStar(require("../sources-static"));
async function file(ctx) {
    const sources = { ...availableStaticSources, ...(ctx.config.static_sources || {}) };
    const sourceName = ctx.query.source || 'default';
    const source = sources[sourceName];
    if (!source)
        return ctx.helpers.httpNotFound();
    try {
        const sourced = (await source(ctx)) || {};
        if (!sourced)
            return ctx.helpers.httpNotFound();
        if (sourced.buffer)
            return ctx.helpers.buffer({ contentType: 'application/pdf', ...sourced });
        if (sourced.location)
            return ctx.helpers.redirect(sourced);
        if (!source.headers && !source.body)
            return ctx.helpers.httpNotFound();
        return ctx.helpers.http(sourced);
    }
    catch (e) {
        throw new lambda_utils_1.UnderlyingExecutionError(e, 'file', { sourceName });
    }
}
exports.file = file;
exports.default = file;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hY3Rpb25zL2ZpbGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEseURBQW9GO0FBQ3BGLDBFQUE0RDtBQUVyRCxLQUFLLFVBQVUsSUFBSSxDQUFDLEdBQVE7SUFDL0IsTUFBTSxPQUFPLEdBQUcsRUFBQyxHQUFHLHNCQUFzQixFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLGNBQWMsSUFBSSxFQUFFLENBQUMsRUFBQyxDQUFDO0lBQ2xGLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQztJQUNqRCxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbkMsSUFBSSxDQUFDLE1BQU07UUFBRSxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDL0MsSUFBSTtRQUNBLE1BQU0sT0FBTyxHQUFHLENBQUMsTUFBTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDMUMsSUFBSSxDQUFDLE9BQU87WUFBRyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDakQsSUFBSSxPQUFPLENBQUMsTUFBTTtZQUFFLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBQyxXQUFXLEVBQUUsaUJBQWlCLEVBQUUsR0FBRyxPQUFPLEVBQUMsQ0FBQyxDQUFDO1FBQzVGLElBQUksT0FBTyxDQUFDLFFBQVE7WUFBRSxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNELElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUk7WUFBRSxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDdkUsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztLQUNwQztJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1IsTUFBTSxJQUFJLHVDQUF3QixDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBQyxVQUFVLEVBQUMsQ0FBQyxDQUFDO0tBQy9EO0FBQ0wsQ0FBQztBQWZELG9CQWVDO0FBRUQsa0JBQWUsSUFBSSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtjdHgsIGh0dHBfcmVzcG9uc2UsIFVuZGVybHlpbmdFeGVjdXRpb25FcnJvcn0gZnJvbSBcIkBvaG9hcmVhdS9sYW1iZGEtdXRpbHNcIjtcbmltcG9ydCAqIGFzIGF2YWlsYWJsZVN0YXRpY1NvdXJjZXMgZnJvbSBcIi4uL3NvdXJjZXMtc3RhdGljXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaWxlKGN0eDogY3R4KTogUHJvbWlzZTxodHRwX3Jlc3BvbnNlPiB7XG4gICAgY29uc3Qgc291cmNlcyA9IHsuLi5hdmFpbGFibGVTdGF0aWNTb3VyY2VzLCAuLi4oY3R4LmNvbmZpZy5zdGF0aWNfc291cmNlcyB8fCB7fSl9O1xuICAgIGNvbnN0IHNvdXJjZU5hbWUgPSBjdHgucXVlcnkuc291cmNlIHx8ICdkZWZhdWx0JztcbiAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzW3NvdXJjZU5hbWVdO1xuICAgIGlmICghc291cmNlKSByZXR1cm4gY3R4LmhlbHBlcnMuaHR0cE5vdEZvdW5kKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc291cmNlZCA9IChhd2FpdCBzb3VyY2UoY3R4KSkgfHwge307XG4gICAgICAgIGlmICghc291cmNlZCApIHJldHVybiBjdHguaGVscGVycy5odHRwTm90Rm91bmQoKTtcbiAgICAgICAgaWYgKHNvdXJjZWQuYnVmZmVyKSByZXR1cm4gY3R4LmhlbHBlcnMuYnVmZmVyKHtjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3BkZicsIC4uLnNvdXJjZWR9KTtcbiAgICAgICAgaWYgKHNvdXJjZWQubG9jYXRpb24pIHJldHVybiBjdHguaGVscGVycy5yZWRpcmVjdChzb3VyY2VkKTtcbiAgICAgICAgaWYgKCFzb3VyY2UuaGVhZGVycyAmJiAhc291cmNlLmJvZHkpIHJldHVybiBjdHguaGVscGVycy5odHRwTm90Rm91bmQoKTtcbiAgICAgICAgcmV0dXJuIGN0eC5oZWxwZXJzLmh0dHAoc291cmNlZCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgVW5kZXJseWluZ0V4ZWN1dGlvbkVycm9yKGUsICdmaWxlJywge3NvdXJjZU5hbWV9KTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZpbGUiXX0=